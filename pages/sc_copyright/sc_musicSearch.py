"""Author  : zhouqixiTime    : 2022/4/7 16:22Desc:  音乐搜索页面"""from urllib.parse import unquotefrom common.op_windows import OpWindowsfrom common.readLog import Logfrom common.sendDingTalk import SendDingTalkfrom element.sc_copyright import sc_search_elementfrom pages.basePage import Actionop = OpWindows()selectNum = OpWindows.RandomSelect(op)Ele = sc_search_element.sc_Eleclass SearchPage(Action):    log = Log(__name__)    logger = log.getLog()    def SearchPage(self):        sc_text = "bgm"        self.write(Ele.scHInput, sc_text)  # 输入        self.sleep(1)        self.mouse_hover(Ele.typeBtn)        self.click(Ele.muBtn)        self.sleep(1)        self.click(Ele.scHBtn)        self.sleep(1)        self.searchDeal(sc_text)        self.refresh()    # 操作滚动当前搜索页    def rollPage(self):        try:            self.mouse_hover(Ele.firstMu)            self.rollWeb(Ele.footDiv)            self.sleep(1)            self.rollWeb(Ele.footDiv)            self.sleep(1)            self.click(Ele.backTop)            self.sleep(1)            self.refresh()        except Exception as e:            self.logger.error("版权站-音乐搜索页显示搜索结果滚动页面时异常:%s" % {e})            # SendDingTalk().sendDingTalkMsg("版权站-音乐搜索页显示搜索结果滚动页面时报错")    # 清空音乐搜索输入框，重新输入关键词搜索    def SearchByText(self):        sc_text = "电子"        self.clear(Ele.scInput)        self.write(Ele.scInput, sc_text)        self.click(Ele.scBtn)        self.sleep(2)        self.searchDeal(sc_text)        self.refresh()    # 添加音乐到收藏    def AddCollect(self):        self.mouse_hover(Ele.firstMu)        self.sleep(1)        self.click(Ele.muCollect)        self.sleep(2)        self.collectDialog(len(Ele.coDialog))        self.refresh()    # 取消音乐收藏    def CancelCollect(self):        try:            self.mouse_hover(Ele.firstMu)            self.click(Ele.muCollect)            self.sleep(2)        except Exception as e:            self.logger.error("版权站-音乐搜索页点击取消收藏异常:%s" % {e})            # SendDingTalk().sendDingTalkMsg("版权站-音乐搜索页点击取消收藏异常")    # 音乐详情页    def muDetail(self):        self.mouse_hover(Ele.muTitle)        self.click(Ele.muTitle)        href = self.getElementAttr(Ele.imgHref, 'href')        print("href:", href)        # self.opWindowDeal(href)        self.refresh()        self.home_button()    # 音乐播放操作    def muPlay(self):        self.click(Ele.playBtn)    # 音乐暂停操作    def muPause(self):        self.click(Ele.pauseBtn)    # ----------------公用方法---------------------------    # 收藏音乐异常处理    def collectDialog(self, num):        try:            if num == 0:                # 没有收藏夹，创建,创建完成后点击第一个li                self.click(Ele.coCrBtn)                self.write(Ele.coCrInput, "测试收藏")                self.click(Ele.coSubBtn)            else:                self.click(Ele.coList)                self.click(Ele.coSubBtn)                self.sleep(2)        except Exception as e:            self.logger.error("版权站-音乐搜索页点击添加收藏异常:%s" % {e})            # SendDingTalk().sendDingTalkMsg("版权站-音乐搜索页点击添加收藏异常")    # 打开音乐详情异常处理    def opWindowDeal(self, txt):        try:            self.sleep(2)            self.window(1)            cur_address = unquote(self.getUrl(), encoding="utf8")            self.assert_text(txt, cur_address)            self.close_and_home_page()        except Exception as e:            self.logger.error("版权站-音乐搜索页点击进入音乐详情页异常:%s" % {e})            # SendDingTalk().sendDingTalkMsg("版权站-音乐搜索页点击进入音乐详情页异常")    # 搜索结果异常处理    def searchDeal(self, text):        try:            urlText = unquote(self.getUrl(), encoding="utf8")            keywords = self.getElementAttr(Ele.scInput, 'value')            try:                result = int(self.getText(Ele.scNumber))            except:                result = 0            self.assert_in_abnormal(text, urlText)            self.assert_text(text, keywords)            assert result >= 0        except Exception as e:            self.logger.error("版权站-音乐搜索页，搜索结果显示异常:%s" % {e})            # SendDingTalk().sendDingTalkMsg("版权站-音乐搜索页，搜索结果显示异常")